{
  "domain": "flashcard-app",
  "framework": "fasthtml-fastlite",
  "accumulated_from": [
    "anki-v23",
    "anki-v24",
    "anki-v26"
  ],
  "updated": "2026-01-08",
  "meta_patterns": [
    {
      "name": "layered-build",
      "components": [
        "data-model",
        "crud-routes",
        "algorithm-routes",
        "test-suite"
      ],
      "description": "Foundation-first layering: dataclass -> database -> CRUD -> domain logic -> tests",
      "signal": 5,
      "campaigns": [
        "anki-v23",
        "anki-v24"
      ],
      "conditions": "Works when each layer has clear inputs/outputs and minimal coupling"
    },
    {
      "name": "fastlite-dataclass-sync",
      "components": [
        "python-dataclass",
        "sqlite-table",
        "fastlite-db.create"
      ],
      "description": "Dataclass defines both Python type and database schema via db.create(Class, pk=...)",
      "signal": 4,
      "campaigns": [
        "anki-v23",
        "anki-v24"
      ],
      "conditions": "Works when schema is simple; may not scale to complex relations"
    },
    {
      "name": "post-redirect-get",
      "components": [
        "POST-mutation",
        "303-redirect",
        "GET-confirmation"
      ],
      "description": "All state mutations use POST, redirect with 303 to GET route",
      "signal": 6,
      "campaigns": [
        "anki-v23",
        "anki-v24"
      ],
      "conditions": "Works for form-based web apps; prevents duplicate submissions"
    },
    {
      "name": "algorithm-state-in-model",
      "components": [
        "dataclass-fields",
        "algorithm-state"
      ],
      "description": "Algorithm state (interval, next_review) stored directly in entity dataclass",
      "signal": 4,
      "campaigns": [
        "anki-v23",
        "anki-v24"
      ],
      "conditions": "Works when algorithm state is per-entity; clean for simple algorithms"
    },
    {
      "name": "fastlite-dataclass-persistence",
      "components": [
        "#pattern/dataclass-fields",
        "#pattern/db-create-pk"
      ],
      "description": "Python dataclass defines schema; db.create(Class, pk='id') creates SQLite table",
      "occurrences": 2,
      "signal": "positive",
      "campaigns": [
        "anki-v26"
      ]
    },
    {
      "name": "post-redirect-get-303",
      "components": [
        "#pattern/post-route",
        "#pattern/redirect-303"
      ],
      "description": "POST routes use RedirectResponse(status_code=303) to prevent form resubmission",
      "occurrences": 3,
      "signal": "positive",
      "campaigns": [
        "anki-v26"
      ]
    },
    {
      "name": "fasthtml-app-structure",
      "components": [
        "#pattern/fast-app",
        "#pattern/rt-decorator"
      ],
      "description": "fast_app() returns (app, rt); rt decorator defines routes with type hints",
      "occurrences": 2,
      "signal": "positive",
      "campaigns": [
        "anki-v26"
      ]
    },
    {
      "name": "behavior-driven-tests",
      "components": [
        "#pattern/test-client",
        "#pattern/test-per-behavior"
      ],
      "description": "Tests organized by user behavior (create, list, delete, study) not by route",
      "occurrences": 2,
      "signal": "positive",
      "campaigns": [
        "anki-v26"
      ]
    }
  ],
  "failure_modes": [
    {
      "name": "date-string-mismatch",
      "description": "SQLite stores Python date objects as ISO strings. Direct comparison fails.",
      "occurrences": 3,
      "impact_tokens": 429000,
      "prevention": "TWO-PART FIX: (1) Use db.create(Class, pk='id', transform=True) for storage/retrieval. (2) In query logic, compare with date.today().isoformat() not date.today() directly.",
      "mitigation": "If table already created without transform: compare with str(date.today()) or parse dates explicitly.",
      "symptom": "card.next_review <= date.today() returns unexpected results or fails silently",
      "campaigns": [
        "anki-v23",
        "anki-v35",
        "anki-v36"
      ],
      "resolved": [
        "anki-v24"
      ],
      "evolution": "v36 discovered transform=True alone insufficient - query comparisons also need isoformat()",
      "warn_for": [
        "data-model",
        "study-routes",
        "date-fields",
        "next_review",
        "db.create",
        "date-comparison"
      ]
    }
  ],
  "evolution": [
    {
      "from": "raw SQL queries",
      "to": "dataclass + fastlite",
      "reason": "Type-safe CRUD without SQL strings",
      "campaigns": [
        "anki-v23"
      ]
    },
    {
      "from": "parallel task routing",
      "to": "sequential task routing",
      "reason": "Knowledge flows forward; complex tasks benefit from prior context",
      "campaigns": [
        "anki-v23 -> anki-v24"
      ],
      "impact": "-32% tokens on complex tasks"
    },
    {
      "from": "raw-sqlite-queries",
      "to": "fastlite-orm",
      "reason": "Dataclass defines schema; ORM handles CRUD operations",
      "campaigns": [
        "anki-v26"
      ]
    }
  ],
  "verification_patterns": {
    "data-model": "python3 -c \"from main import Model; print(Model)\"",
    "routes": "uv run pytest test_app.py -k <route_prefix>",
    "full-suite": "uv run pytest test_app.py -v"
  }
}